<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="H's blog" href="https://1lunarveil.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="H's blog" href="https://1lunarveil.github.io/atom.xml"><link rel="alternate" type="application/json" title="H's blog" href="https://1lunarveil.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="教程"><link rel="canonical" href="https://1lunarveil.github.io/2025/10/11/vmware2/"><title>vmware2 | H-solo = H's blog = Weclome</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">vmware2</h1><div class="meta"><span class="item" title="创建时间：2025-10-11 17:36:21"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2025-10-11T17:36:21+08:00">2025-10-11</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>4.5k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>4 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">H-solo</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="/images/bg/22.jpg"></li><li class="item" data-background-image="/images/bg/34.jpg"></li><li class="item" data-background-image="/images/bg/17.jpg"></li><li class="item" data-background-image="/images/bg/14.jpg"></li><li class="item" data-background-image="/images/bg/3.jpg"></li><li class="item" data-background-image="/images/bg/10.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://1lunarveil.github.io/2025/10/11/vmware2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="1LunarVeil"><meta itemprop="description" content="Weclome, A personal blog of a computer novice"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="H's blog"></span><div class="body md" itemprop="articleBody"><h1 id="vmware-虚拟局域网搭建实验指导"><a class="anchor" href="#vmware-虚拟局域网搭建实验指导">#</a> VMware 虚拟局域网搭建实验指导</h1><p>原是不打算更新了，最近有亿点点小忙，但是周围人都催得紧，说做不出来，又快要到截止时间了，今晚赶紧抽空更新。</p><h3 id="网络规划"><a class="anchor" href="#网络规划">#</a> 网络规划</h3><table><thead><tr><th>虚拟网段</th><th>对应功能</th><th>关联设备</th></tr></thead><tbody><tr><td>VMnet1（192.168.11.0/24）</td><td>企业内部网络</td><td>200301（企业出口路由器）、XP01（网内主机）</td></tr><tr><td>VMnet2（112.111.11.0/24）</td><td>企业出口与互联网中转连接段</td><td>200301、200302（互联网中转路由器）</td></tr><tr><td>VMnet3（202.102.134.0/24）</td><td>互联网侧网络</td><td>200302、XP02（VPN 客户端）</td></tr></tbody></table><h2 id="实验步骤基本网络环境搭建"><a class="anchor" href="#实验步骤基本网络环境搭建">#</a> 实验步骤：基本网络环境搭建</h2><h3 id="1-虚拟网段配置vmware-网络编辑器"><a class="anchor" href="#1-虚拟网段配置vmware-网络编辑器">#</a> 1. 虚拟网段配置（VMware 网络编辑器）</h3><p>打开 VMware，进入「编辑」-「虚拟网络编辑器」，分别创建并配置三个虚拟网段：</p><ul><li>VMnet1：设置子网为 192.168.11.0，子网掩码 255.255.255.0</li><li>VMnet2：设置子网为 112.111.11.0，子网掩码 255.255.255.0</li><li>VMnet3：设置子网为 202.102.134.0，子网掩码 255.255.255.0</li></ul><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510101955971.png" alt="96e9b2bda523736f7d07fc57102daee0"></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510101956133.png" alt="96e4aa43a7ced43b56677a1a42aaa8f4"></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510101956956.png" alt="37a7c97382a42a2cd5125151988dfce2"></p><p><strong>如此即可</strong></p><h3 id="2-各虚拟机配置含系统-网卡-ip-功能"><a class="anchor" href="#2-各虚拟机配置含系统-网卡-ip-功能">#</a> 2. 各虚拟机配置（含系统、网卡、IP、功能）</h3><h4 id="1虚拟机-200301企业出口路由器建议安装-windows-server-2003-系统"><a class="anchor" href="#1虚拟机-200301企业出口路由器建议安装-windows-server-2003-系统">#</a> （1）虚拟机 200301（企业出口路由器，建议安装 Windows Server 2003 系统）</h4><ol><li><p>添加两块网卡：</p><ul><li>网卡 1：连接 VMnet1，配置 IP 为 192.168.11.1，子网掩码 255.255.255.0</li><li>网卡 2：连接 VMnet2，配置 IP 为 112.111.11.11，子网掩码 255.255.255.0</li></ul><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510101957118.png" alt="8815a0e5aca065ad2381f7dbc4ef268e"></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510101957337.png" alt="89577c39a569d0491300aadde12ed47d"></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510101957108.png" alt="657f582c0c6d0d25dd5ee6629d58cace"></p><p><strong>依旧是我们的老步骤了</strong></p></li><li><p>配置路由功能：进入「路由和远程访问」，用「自定义方式」添加 VPN 和 NAT 路由功能</p></li></ol><p><strong>很多人一看到路由和远程访问直接傻眼了，根本不知道在哪emmmm</strong>那还是看下面吧</p><h2 id="自定义添加-vpn-和-nat-路由功能步骤"><a class="anchor" href="#自定义添加-vpn-和-nat-路由功能步骤">#</a> 自定义添加 VPN 和 NAT 路由功能步骤</h2><p><strong>准备前置工作：把你的防火墙关了（包括物理机）</strong></p><h3 id="1-打开-路由和远程访问-管理工具"><a class="anchor" href="#1-打开-路由和远程访问-管理工具">#</a> 1. 打开 “路由和远程访问” 管理工具</h3><ol><li>依次点击「控制面板」-「管理工具」-「路由和远程访问」，打开管理界面。</li><li>在左侧导航树中，右键点击当前计算机名称（如 “200301”），选择「配置并启用路由和远程访问」，启动配置向导。</li></ol><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510102047486.png" alt="9ac33ee23ae71717f1423ce2447c5a5c"></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510102052617.png" alt="24cb82d3a346466aac04aaa670f123a7"></p><p>如果还是跳出来这种情况</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510102148865.png" alt="c86d1b57c87dc24900b76d4b4778b538"></p><p><strong>那就试试这一招</strong></p><p>菜单栏打开，然后点击管理工具，选中服务，反到最下面，找到windows firewall，然后将服务状态停止，启动类型禁用，就可以了。<img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510102150034.png" alt="5d5623947c46c912b5848d8b5750350d"></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510102149142.png" alt="da4d47e18a2a7808c239bed2018e54ba"></p><h3 id="2-选择-自定义配置核心步骤避免断网"><a class="anchor" href="#2-选择-自定义配置核心步骤避免断网">#</a> 2. 选择 “自定义配置”（核心步骤，避免断网）</h3><ol><li><p>向导首页点击「下一步」，在 “配置” 页面中，<strong>必须选择 “自定义配置”</strong>（若选其他预设配置可能导致网络中断），点击「下一步」。</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510102159491.png" alt="60424e331e862025b7ba5942dfdb4743"></p></li><li><p>在 “自定义配置” 选项中，勾选以下两项（实验需求核心功能）：</p><ul><li>✅ <strong>VPN 访问</strong>：支持远程客户端（如 XP02）通过 VPN 连接企业内网。</li><li>✅ <strong>NAT</strong>：实现企业内部网段（VMnet1：192.168.11.0/24）通过出口地址池（112.111.11.12-20）访问外部网络。</li><li>（可选补充：若需实现不同网段间直接通信，可额外勾选 “LAN 路由”，实验中 200302 需此功能，200301 可根据需求选择）</li></ul><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510102200920.png" alt="aca97324d36e3c8dbcc5522c41252de1"></p></li><li><p>点击「下一步」，确认配置后点击「完成」，此时系统会提示 “是否立即启动服务”，选择「是」。</p></li></ol><h3 id="3-配置-nat-接口关键关联外网网卡"><a class="anchor" href="#3-配置-nat-接口关键关联外网网卡">#</a> 3. 配置 NAT 接口（关键：关联外网网卡）</h3><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510102204637.png" alt="d16ee7cb9ec002cefd8834b7bbde0115">此时我们的界面已经变成了这样</p><ol><li><p>回到 “路由和远程访问” 界面，展开左侧导航树：「IP路由选择」-「NAT」。</p></li><li><p>右键点击「NAT」，选择「新增接口」，在弹出的 “网络接口” 列表中，选择<strong>连接 VMnet2 的网卡</strong>（即 200301 的外网网卡，IP 112.111.11.11/24），点击「确定」。（我这边连接VMnet2网卡的是本地连接3）</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111426595.png" alt="5b112bee41922776dd83aad0d2eab2e7"></p></li><li><p>在 “NAT 接口属性” 中，选择「公用接口连接到 Internet」，并勾选「在此接口上启用 NAT」，点击「确定」（此步骤确保内部网段通过该网卡转换为外网地址访问互联网）。</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111428381.png" alt="1f61c33b5f7452e1c2a91c0968a3584c"></p></li></ol><h3 id="4-配置-vpn-静态地址池分配客户端-ip"><a class="anchor" href="#4-配置-vpn-静态地址池分配客户端-ip">#</a> 4. 配置 VPN 静态地址池（分配客户端 IP）</h3><ol><li><p>展开左侧导航树「IP路由选择」，右键点击「静态路由」，选择「新建静态路由」。</p></li><li><p>在向导中点击「下一步」，输入 VPN 客户端的 IP 地址范围，点击「下一步」直至完成（此地址池用于分配给 XP02 等 VPN 客户端，确保客户端接入后能与内网通信）。</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111450291.png" alt="ff0cca672a822f29180bf2bae7b0470e"></p></li></ol><h3 id="5-配置-vpn-用户允许客户端拨号"><a class="anchor" href="#5-配置-vpn-用户允许客户端拨号">#</a> 5. 配置 VPN 用户（允许客户端拨号）</h3><ol><li><p>打开「控制面板」-「管理工具」-「计算机管理」，展开「本地用户和组」-「用户」。</p></li><li><p>右键点击空白处，选择「新用户」，设置用户名（如 “VPN_User”）、密码，勾选「用户不能更改密码」和「密码永不过期」（提升安全性），点击「创建」。（密码最好是方便好记的，我这里直接是123456）</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111454106.png" alt="11b411aad01c56fbbaf9f6e1069437c9"></p></li><li><p>双击新建的用户，切换到「拨入」选项卡，在 “远程访问权限” 中选择「允许访问」，点击「确定」（此步骤确保该用户可通过 VPN 连接服务器）。</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111456383.png" alt="2750b564d0448a33e7d98ac6e29330f3"></p></li></ol><h3 id="6-重启服务生效配置"><a class="anchor" href="#6-重启服务生效配置">#</a> 6. 重启服务生效配置</h3><ol><li><p>回到 “路由和远程访问” 界面，右键点击计算机名称（200301），选择「所有任务」-「重启」。</p></li><li><p>等待服务重启完成，此时 VPN 和 NAT 路由功能已启用，可通过 XP02（VPN 客户端）测试连接。</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111457573.png" alt="60c41fd0ef8967ad42a80bab8f2eef46"></p></li></ol><h3 id="安装抓包工具如-wireshark"><a class="anchor" href="#安装抓包工具如-wireshark">#</a> 安装抓包工具（如 Wireshark）</h3><h4 id="使用-vmware-tools-共享文件夹功能"><a class="anchor" href="#使用-vmware-tools-共享文件夹功能">#</a> 使用 VMware Tools 共享文件夹功能</h4><ol><li><p>安装 VMware Tools：</p><ul><li>在 VMware Workstation 界面中，选中 200301 虚拟机，点击菜单栏的 “虚拟机”，选择 “安装 VMware Tools”。</li><li>在虚拟机中，打开 “我的电脑”，会看到 VMware Tools 的光驱盘符，双击打开，运行安装程序，按照提示完成 VMware Tools 的安装。安装完成后，可能需要重启虚拟机。</li></ul><p><strong>如果当初虚拟机安装的时候没有自己瞎捣鼓，VMware Tools是正常安装好的，就不用管</strong></p></li><li><p>在虚拟机中访问文件夹并安装：</p><ul><li>重启虚拟机后，在物理机找到文件夹，对着压缩包来一个复制，然后再到虚拟机来一个粘贴，就能看到 Wireshark 的压缩包。</li><li>右键解压该压缩包到虚拟机的本地磁盘（如 C 盘的某个文件夹），解压完成后，进入解压后的文件夹，找到 Wireshark 的安装程序（通常是.exe 后缀的文件），双击运行，按照安装向导的提示完成 Wireshark 的安装。</li></ul></li></ol><h4 id="虚拟机-200302互联网中转路由器建议安装-windows-server-2003-系统"><a class="anchor" href="#虚拟机-200302互联网中转路由器建议安装-windows-server-2003-系统">#</a> 虚拟机 200302（互联网中转路由器，建议安装 Windows Server 2003 系统）</h4><ol><li>添加两块网卡：<ul><li>网卡 1：连接 VMnet2，配置 IP 为 112.111.11.12，子网掩码 255.255.255.0</li><li>网卡 2：连接 VMnet3，配置 IP 为 202.102.134.1，子网掩码 255.255.255.0</li></ul></li><li>配置路由功能：进入「路由和远程访问」，用「自定义方式」添加 LAN 间路由功能</li><li>安装抓包工具（如 Wireshark）</li></ol><h4 id="虚拟机-xp01企业网内主机安装-windows-xp-系统"><a class="anchor" href="#虚拟机-xp01企业网内主机安装-windows-xp-系统">#</a> 虚拟机 XP01（企业网内主机，安装 Windows XP 系统）</h4><ol><li>配置网卡：连接 VMnet1，设置 IP 为 192.168.11.11，子网掩码 255.255.255.0，网关为 192.168.11.1</li><li>安装抓包工具（如 Wireshark）</li></ol><h4 id="虚拟机-xp02vpn-客户端安装-windows-xp-系统"><a class="anchor" href="#虚拟机-xp02vpn-客户端安装-windows-xp-系统">#</a> 虚拟机 XP02（VPN 客户端，安装 Windows XP 系统）</h4><ol><li>配置网卡：连接 VMnet3，设置 IP 为 202.102.134.11，子网掩码 255.255.255.0，网关为 202.102.134.1</li><li>安装抓包工具（如 Wireshark）</li></ol><p>这些都是一样的老步骤，我就不细说了，照着之前的步骤做就OK</p><h2 id="三-实验结果测试含问题排查"><a class="anchor" href="#三-实验结果测试含问题排查">#</a> 三、实验结果测试（含问题排查）</h2><h3 id="1-基础连通性测试需截图留存"><a class="anchor" href="#1-基础连通性测试需截图留存">#</a> 1. 基础连通性测试（需截图留存）</h3><ol><li>在 XP01 上执行命令<code>ping 192.168.11.1</code>（ping 200301 的 VMnet1 网卡 IP），测试企业内网连通性</li><li>在 200301 上执行命令<code>ping 112.111.11.12</code>（ping 200302 的 VMnet2 网卡 IP），测试出口与中转路由器连通性</li><li>在 XP02 上执行命令<code>ping 202.102.134.1</code>（ping 200302 的 VMnet3 网卡 IP），测试客户端与中转路由器连通性</li></ol><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111622395.png" alt="bea03935e8ca7c143acc448b268943dc"></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111623941.png" alt="c78f6dc9fb174b4e18bdaf900f9719a6"></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111623921.png" alt="3a008a2017950e3e0dc0888e491e4125"></p><p>所有测试通过后，对每个虚拟机执行「快照」功能，保存当前正常环境（虚拟机左侧状态栏处，选中目标虚拟机，点击右键，看到下面的快照，点击拍摄快照）</p><h3 id="2-针对性测试与问题排查"><a class="anchor" href="#2-针对性测试与问题排查">#</a> 2. 针对性测试与问题排查</h3><h4 id="1测试200301-ping-xp01ip1921681111"><a class="anchor" href="#1测试200301-ping-xp01ip1921681111">#</a> （1）测试：200301 ping XP01（IP：192.168.11.11）</h4><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111630069.png" alt="800a9e2ea89dcbe1bac6dd3d6475b966"></p><p>我这里是通的</p><ul><li>若不通，常见原因：XP01 防火墙开启，拦截 ICMP 请求；或 XP01IP / 网关配置错误</li><li>解决方法：关闭 XP01 的 Windows 防火墙；重新检查 XP01 的 IP（192.168.11.11）、子网掩码（255.255.255.0）、网关（192.168.11.1）是否正确</li></ul><h4 id="2测试xp02-ping-1121111111200301-的-vmnet2-网卡-ip"><a class="anchor" href="#2测试xp02-ping-1121111111200301-的-vmnet2-网卡-ip">#</a> （2）测试：XP02 ping 112.111.11.11（200301 的 VMnet2 网卡 IP）</h4><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111630037.png" alt="bc57c7c95e03b70aa0b0a0c3e55945f7"></p><p>这里没通，开始按步骤检查</p><ul><li>若不通，排查步骤：<ol><li><p>抓包分析：分别在 XP02、200302、200301 上打开抓包工具，过滤 ICMP 协议，查看数据包传输情况（需截图留存）</p><ul><li>XP02 抓包：查看是否发出 ICMP 请求包</li></ul><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111724880.png" alt="ce0059bd940ca32678ccbfbbaab9c690"></p><ul><li>200302 抓包：查看是否接收并转发 ICMP 请求包</li></ul><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111724485.png" alt="fe716b2c718f50c1950311e90843625a"></p><ul><li>200301 抓包：查看是否接收 ICMP 请求包，是否返回响应包</li></ul><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111724057.png" alt="89377f257f429845c77a03cf135c3c63"></p><p>通过对抓包文件进行分析，<strong>确认 XP02（202.102.134.11）发出的 ICMP ping 请求包到达了 200302，且 200302 也将请求包转发给了 200301，但没有捕获到 200301 返回的 ICMP 响应包</strong>。这说明 ping 不通的核心问题出在<strong>200301 未返回响应</strong></p><h5 id="1-已确认的通信环节请求包能到达-200301"><a class="anchor" href="#1-已确认的通信环节请求包能到达-200301">#</a> 1. 已确认的通信环节（请求包能到达 200301）</h5><ul><li><p>两张抓包中都能看到源 IP 为202.102.134.11、目的 IP 为112.111.11.11的 ICMPEcho (ping) request</p><p>包，且序号（seq）一致，说明：</p><ul><li>XP02 → 200302：请求包成功传输。</li><li>200302 → 200301：请求包成功转发（因为 200301 的抓包也能看到相同的请求包）。</li></ul></li></ul><h5 id="2-问题环节200301-未返回响应"><a class="anchor" href="#2-问题环节200301-未返回响应">#</a> 2. 问题环节：200301 未返回响应</h5><ul><li><strong>现象</strong>：两张抓包中都<strong>没有</strong>源 IP 为<code>112.111.11.11</code>、目的 IP 为<code>202.102.134.11</code>的 ICMP <code>Echo reply</code>（响应包）。</li><li>可能原因及排查建议：<ul><li>原因 1：200301 的防火墙拦截了 ICMP 响应<ul><li>排查：进入 200301 的 “Windows 防火墙” 设置（或第三方防火墙软件），检查<strong>入站规则</strong>是否允许 ICMP 请求，且<strong>出站规则</strong>是否允许 ICMP 响应。如果防火墙开启且未放行 ICMP，会导致 200301 收到请求后，无法发送响应包。</li></ul></li><li>原因 2：200301 缺少回传路由<ul><li>排查：在 200301 上执行 <code>route print</code> 命令，查看路由表中是否有<strong>到 202.102.134.0/24 网段的路由</strong>。如果没有，200301 收到请求后，不知道如何将响应包发回 XP02 所在网段，导致响应包被丢弃。</li><li>解决：若缺少路由，需在 200301 上添加静态路由</li></ul></li><li>原因 3：200301 的 NAT 配置未放行 ICMP<ul><li>排查：如果 200301 启用了 NAT（网络地址转换），需检查 NAT 规则是否允许 ICMP 协议的双向通信。若 NAT 仅放行 TCP/UDP，ICMP 响应包会被 NAT 设备拦截。</li></ul></li></ul></li></ul></li><li><p>路由表分析：在 200301 上执行命令<code>route print</code>，查看是否存在到 202.102.134.0/24 网段的路由（若无则导致无法回传响应包）发现是存在的</p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111732983.png" alt="0a1371ea3bb31e3b54c7e01eb5cece67"></p><p><strong>排查了防火墙和NAT，发现都没有任何问题，那么只有可能是VPN设置出了问题，回头一看发现我前面设置的时候因为脑子太乱了，本地连接选错了，调整之后再次尝试ping，成功。</strong></p><p><img data-src="https://cdn.jsdelivr.net/gh/1LunarVeil/Picture-bed@main/img/202510111732013.png" alt="7bdd57cedb5de0555c85e65bdd0ba4fa"></p></li></ol></li></ul><div class="tags"><a href="/tags/%E6%95%99%E7%A8%8B/" rel="tag"><i class="ic i-tag"></i> 教程</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2025-10-11 17:41:15" itemprop="dateModified" datetime="2025-10-11T17:41:15+08:00">2025-10-11</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="1LunarVeil 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="1LunarVeil 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="1LunarVeil 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>1LunarVeil： </strong>1LunarVeil <i class="ic i-at"><em>@</em></i>H's blog</li><li class="link"><strong>本文链接：</strong> <a href="https://1lunarveil.github.io/2025/10/11/vmware2/" title="vmware2">https://1lunarveil.github.io/2025/10/11/vmware2/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2025/09/21/vmware/" itemprop="url" rel="prev" data-background-image="&#x2F;images&#x2F;bg&#x2F;36.jpg" title="vmware"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>vmware</h3></a></div><div class="item right"><a href="/2025/10/15/vmware3/" itemprop="url" rel="next" data-background-image="&#x2F;images&#x2F;bg&#x2F;13.jpg" title="vmware3"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>vmware3</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#vmware-%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91%E6%90%AD%E5%BB%BA%E5%AE%9E%E9%AA%8C%E6%8C%87%E5%AF%BC"><span class="toc-number">1.</span> <span class="toc-text">VMware 虚拟局域网搭建实验指导</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92"><span class="toc-number">1.0.1.</span> <span class="toc-text">网络规划</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4%E5%9F%BA%E6%9C%AC%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.1.</span> <span class="toc-text">实验步骤：基本网络环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%99%9A%E6%8B%9F%E7%BD%91%E6%AE%B5%E9%85%8D%E7%BD%AEvmware-%E7%BD%91%E7%BB%9C%E7%BC%96%E8%BE%91%E5%99%A8"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. 虚拟网段配置（VMware 网络编辑器）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%90%AB%E7%B3%BB%E7%BB%9F-%E7%BD%91%E5%8D%A1-ip-%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. 各虚拟机配置（含系统、网卡、IP、功能）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E8%99%9A%E6%8B%9F%E6%9C%BA-200301%E4%BC%81%E4%B8%9A%E5%87%BA%E5%8F%A3%E8%B7%AF%E7%94%B1%E5%99%A8%E5%BB%BA%E8%AE%AE%E5%AE%89%E8%A3%85-windows-server-2003-%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">（1）虚拟机 200301（企业出口路由器，建议安装 Windows Server 2003 系统）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B7%BB%E5%8A%A0-vpn-%E5%92%8C-nat-%E8%B7%AF%E7%94%B1%E5%8A%9F%E8%83%BD%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.2.</span> <span class="toc-text">自定义添加 VPN 和 NAT 路由功能步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%89%93%E5%BC%80-%E8%B7%AF%E7%94%B1%E5%92%8C%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE-%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 打开 “路由和远程访问” 管理工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%80%89%E6%8B%A9-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%A0%B8%E5%BF%83%E6%AD%A5%E9%AA%A4%E9%81%BF%E5%85%8D%E6%96%AD%E7%BD%91"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. 选择 “自定义配置”（核心步骤，避免断网）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE-nat-%E6%8E%A5%E5%8F%A3%E5%85%B3%E9%94%AE%E5%85%B3%E8%81%94%E5%A4%96%E7%BD%91%E7%BD%91%E5%8D%A1"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. 配置 NAT 接口（关键：关联外网网卡）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AE-vpn-%E9%9D%99%E6%80%81%E5%9C%B0%E5%9D%80%E6%B1%A0%E5%88%86%E9%85%8D%E5%AE%A2%E6%88%B7%E7%AB%AF-ip"><span class="toc-number">1.2.4.</span> <span class="toc-text">4. 配置 VPN 静态地址池（分配客户端 IP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE-vpn-%E7%94%A8%E6%88%B7%E5%85%81%E8%AE%B8%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8B%A8%E5%8F%B7"><span class="toc-number">1.2.5.</span> <span class="toc-text">5. 配置 VPN 用户（允许客户端拨号）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1%E7%94%9F%E6%95%88%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.6.</span> <span class="toc-text">6. 重启服务生效配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%E5%A6%82-wireshark"><span class="toc-number">1.2.7.</span> <span class="toc-text">安装抓包工具（如 Wireshark）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-vmware-tools-%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">使用 VMware Tools 共享文件夹功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA-200302%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%AD%E8%BD%AC%E8%B7%AF%E7%94%B1%E5%99%A8%E5%BB%BA%E8%AE%AE%E5%AE%89%E8%A3%85-windows-server-2003-%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">虚拟机 200302（互联网中转路由器，建议安装 Windows Server 2003 系统）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA-xp01%E4%BC%81%E4%B8%9A%E7%BD%91%E5%86%85%E4%B8%BB%E6%9C%BA%E5%AE%89%E8%A3%85-windows-xp-%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">虚拟机 XP01（企业网内主机，安装 Windows XP 系统）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA-xp02vpn-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85-windows-xp-%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.7.4.</span> <span class="toc-text">虚拟机 XP02（VPN 客户端，安装 Windows XP 系统）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C%E6%B5%8B%E8%AF%95%E5%90%AB%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">1.3.</span> <span class="toc-text">三、实验结果测试（含问题排查）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E8%BF%9E%E9%80%9A%E6%80%A7%E6%B5%8B%E8%AF%95%E9%9C%80%E6%88%AA%E5%9B%BE%E7%95%99%E5%AD%98"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. 基础连通性测试（需截图留存）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%92%88%E5%AF%B9%E6%80%A7%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. 针对性测试与问题排查</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E6%B5%8B%E8%AF%95200301-ping-xp01ip1921681111"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">（1）测试：200301 ping XP01（IP：192.168.11.11）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E6%B5%8B%E8%AF%95xp02-ping-1121111111200301-%E7%9A%84-vmnet2-%E7%BD%91%E5%8D%A1-ip"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">（2）测试：XP02 ping 112.111.11.11（200301 的 VMnet2 网卡 IP）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%B7%B2%E7%A1%AE%E8%AE%A4%E7%9A%84%E9%80%9A%E4%BF%A1%E7%8E%AF%E8%8A%82%E8%AF%B7%E6%B1%82%E5%8C%85%E8%83%BD%E5%88%B0%E8%BE%BE-200301"><span class="toc-number">1.3.2.2.1.</span> <span class="toc-text">1. 已确认的通信环节（请求包能到达 200301）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%97%AE%E9%A2%98%E7%8E%AF%E8%8A%82200301-%E6%9C%AA%E8%BF%94%E5%9B%9E%E5%93%8D%E5%BA%94"><span class="toc-number">1.3.2.2.2.</span> <span class="toc-text">2. 问题环节：200301 未返回响应</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="1LunarVeil" data-src="/images/avatar.jpg"><p class="name" itemprop="name">1LunarVeil</p><div class="description" itemprop="description">A personal blog of a computer novice</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">12</span> <span class="name">文章</span></a></div><div class="item tags"><a href="/tags/"><span class="count">4</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tLzFMdW5hclZlaWw=" title="https:&#x2F;&#x2F;github.com&#x2F;1LunarVeil"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTkyMTM1MzE1NDI=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;9213531542"><i class="ic i-cloud-music"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2025/09/21/vmware/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2025/10/15/vmware3/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2025/10/15/AI%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/" title="AI安全学习">AI安全学习</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/11/19/Java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Java学习笔记——入门篇">Java学习笔记——入门篇</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/10/15/vmware3/" title="vmware3">vmware3</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/12/08/Java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E5%88%A4%E6%96%AD%E7%AF%87/" title="Java学习笔记——判断篇">Java学习笔记——判断篇</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/09/21/vmware/" title="vmware">vmware</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/12/06/Java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E6%96%B9%E6%B3%95%E7%AF%87/" title="Java学习笔记——方法篇">Java学习笔记——方法篇</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/10/11/vmware2/" title="vmware2">vmware2</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/09/18/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B8%B8%E7%94%A8%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD/" title="渗透测试常用专业术语">渗透测试常用专业术语</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/10/20/%E5%8D%8E%E4%B8%BAAI%E5%B2%97-%E7%AC%94%E8%AF%95/" title="华为AI岗--笔试（一）">华为AI岗--笔试（一）</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2025/10/15/AI%E5%AE%89%E5%85%A8%E6%9C%89%E5%85%B3%E6%9C%AF%E8%AF%AD%E5%92%8C%E7%9F%A5%E8%AF%86%E7%82%B9%E7%9A%84%E6%95%B4%E5%90%88/" title="AI安全有关术语和知识点的整合">AI安全有关术语和知识点的整合</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">1LunarVeil @ H-solo</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">69k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:03</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2025/10/11/vmware2/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>